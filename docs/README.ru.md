# spath

![spath banner](../img/1765746905745-019b1eb7-0a53-7269-9766-481e69cf3b4e.png)

Сканер безопасности и оптимизатор PATH для Windows.

## Проблема

Пути в PATH с пробелами без кавычек создают уязвимости безопасности, которые могут быть использованы для повышения привилегий.

## Решение

spath обнаруживает и исправляет эти уязвимости автоматически.

## Установка

### Скачать (проще всего)

Скачайте с [GitHub Releases](https://github.com/vremyavnikuda/spath_cli/releases):

- `spath-setup.exe` — Установщик (автоматически добавляет в PATH)
- `spath.exe` — Портативный исполняемый файл
- `spath-windows-x64.zip` — Архив с документацией

### Из crates.io

```bash
cargo install spath-cli
```

### Из исходников

```bash
cargo build --release
```

Расположение бинарника: `target/release/spath.exe`

## Команды

### Сканирование

Анализ PATH на наличие проблем безопасности.

```bash
spath scan                    # Сканировать только USER PATH
spath scan --verbose          # Показать детальную информацию
spath scan --audit            # Показать статистику аудита
spath scan --system           # Сканировать SYSTEM PATH (требует admin для исправления)
```

### Проверка безопасности

Проверка, являются ли критические проблемы реально эксплуатируемыми, путём поиска вредоносных файлов.

```bash
spath verify                  # Проверить безопасность USER PATH
spath verify --system         # Проверить безопасность SYSTEM PATH
```

Эта команда проверяет, могут ли пути с пробелами без кавычек быть реально эксплуатированы, ища вредоносные файлы типа `C:\Program.exe`, которые могут перехватить легитимные программы.

### Исправление

Исправление проблем в USER PATH (не требует прав администратора).

```bash
spath fix --dry-run           # Предпросмотр изменений без применения
spath fix                     # Применить исправления к USER PATH
spath fix --delicate          # Запросить подтверждение перед изменениями
```

### Анализ

Анализ SYSTEM и USER PATH.

```bash
spath analyze
```

### Очистка

Удаление дубликатов и оптимизация PATH.

```bash
spath clean --dry-run         # Предпросмотр очистки
spath clean                   # Очистить USER PATH
spath clean --system          # Очистить SYSTEM PATH (требует admin)
spath clean --delicate        # Запросить подтверждение
```

### Управление резервными копиями

```bash
spath backup                  # Создать резервную копию текущего PATH
spath list-backups            # Показать все доступные резервные копии
spath restore <файл>          # Восстановить из резервной копии
spath restore <файл> --delicate  # Восстановить с подтверждением
```

## Типы проблем

**CRITICAL**: Пути с пробелами без кавычек в системных директориях (например, `C:\Program Files`) - потенциальная уязвимость безопасности, которая может быть эксплуатирована

**WARNING**: Несуществующие пути, относительные пути, или пути с пробелами без кавычек, которые не существуют

**INFO**: Информационные сообщения о правильно оформленных путях или незначительных проблемах

## Проверка безопасности

Команда `verify` различает:
- **Потенциальные риски**: Уязвимые пути, но вредоносные файлы не обнаружены (пока безопасно)
- **Реальные угрозы**: Найдены вредоносные файлы, которые могут эксплуатировать уязвимость (требуется немедленное действие)

Пример: Если `C:\Program Files\App\bin` в PATH без кавычек, инструмент проверяет наличие:
- `C:\Program.exe`
- `C:\Program.com`
- `C:\Program.bat`
- `C:\Program.cmd`

## Рабочий процесс

### Базовый процесс
1. Сканирование: `spath scan --audit`
2. Проверка: `spath verify` (проверка реальных угроз)
3. Резервная копия: `spath backup`
4. Исправление USER PATH: `spath fix`
5. Удаление дубликатов: `spath clean`
6. При необходимости восстановление: `spath restore <файл>`

### Расширенный процесс (с SYSTEM PATH)
1. Сканирование SYSTEM: `spath scan --system`
2. Проверка SYSTEM: `spath verify --system` (проверка эксплойтов)
3. Если безопасно, рассмотрите исправление SYSTEM PATH (требует прав администратора)

## Требования

- Windows 10 или новее
- Rust 1.70+ (для сборки из исходников)

## Опции

- `--dry-run` или `-d` - Предпросмотр изменений без применения
- `--delicate` - Запрос подтверждения перед применением изменений
- `--system` или `-s` - Включить операции с SYSTEM PATH (требует admin)
- `--verbose` или `-v` - Показать детальную информацию
- `--audit` или `-a` - Показать детальный аудит-отчёт

## Примечания

- Изменения USER PATH не требуют прав администратора
- Изменения SYSTEM PATH требуют прав администратора
- Автоматическое создание резервной копии перед изменениями
- Перезапустите приложения для применения изменений PATH
- Используйте `--delicate` для дополнительной безопасности с подтверждением

## Лицензия

MIT License - см. файл [LICENSE](../LICENSE)

## История изменений

См. [CHANGELOG.md](../CHANGELOG.md) для истории версий и примечаний к релизам.
